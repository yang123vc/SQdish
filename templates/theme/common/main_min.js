map=undefined;infoBox=undefined;circle=undefined;function createMapAtPoint(c,d,b){setBoxWH(c);map=new BMap.Map(c);var a=new BMap.Point(d.g,d.w);map.centerAndZoom(a,b);map.addEventListener("click",function(){if(infoBox){$(".leftbox ul li a").removeClass("hover");infoBox.close();if(circle){map.removeOverlay(circle)}}});map.enableScrollWheelZoom();map.enableContinuousZoom()}function setBoxWH(c){var a=$(window).width();var b=$(window).height();$("#"+c).css({width:a+"px",height:b+"px"})}function addOverlay(e,b){if(!b){b="click"}var a=new BMap.Point(e.g,e.w);var d=getMarkerHtm(e);var f=getInfoBoxHtm(e);var c=new BMapLib.RichMarker(d,a,{anchor:new BMap.Size(-18,-80)});map.addOverlay(c);tid=parseInt(e.tid);c.addEventListener(b,function(){openInfoBox1(f,a,e)});markerHover(e)}function markerClick(b,a){$(".leftbox ul li a").removeClass("hover");if(a){$(a).addClass("hover")}$(".marker"+b).click()}function getDats(b,c){var a;$.ajaxSettings.async=false;$.post(b,{Action:"post",id:c},function(d,e){if(e=="success"){a=d}});return a}ibbgphoto1={width:"280px",height:"218px"};function openInfoBox1(c,a,d){if(infoBox){infoBox.close()}if(circle){map.removeOverlay(circle)}infoBox=new BMapLib.InfoBox(map,c,{boxStyle:ibbgphoto1,closeIconMargin:"1px 1px 0 0",enableAutoPan:false,align:INFOBOX_AT_TOP,offset:new BMap.Size(0,30)});var e=parseInt(d.id);var b=new BMap.Marker(a);if(parseInt(d.tid)==2){if(e==4){b.setOffset(new BMap.Size(86,10))}else{if(e==5){b.setOffset(new BMap.Size(114,-3))}else{if(e==6){b.setOffset(new BMap.Size(103,-3))}else{b.setOffset(new BMap.Size(54,-5))}}}}else{if(parseInt(d.tid)==1){b.setOffset(new BMap.Size(95,-5))}else{b.setOffset(new BMap.Size(64,-5))}}map.setCenter(a);map.panTo(a);infoBox.open(b);tid=parseInt(d.tid);if(tid==1||tid==2){circle=new BMap.Circle(a,parseInt(d.circlePath),{fillColor:"blue",strokeWeight:1,fillOpacity:0.1,strokeOpacity:0.1});map.addOverlay(circle)}}function getMarkerHtm(b){var c;c=parseInt(b.tid);var a='<div class="mbox marker{0}">';a+='<img src="{1}" title="{2}" alt="{3}">';if(c!=1&&c!=2){a+='<a href="javascript:;">{4}</a>'}a+="</div>";a=a.replace("{0}",b.id).replace("{2}",b.mtitle).replace("{1}",b.mphoto).replace("{3}",b.mtitle).replace("{4}",b.word);return a}function markerHover(b){var a=$(".marker"+b.id);a.hover(function(){},function(){})}function getInfoBoxHtm(b){if(b.url==""){b.url="bmap_detail.aspx?id="+b.id+"&c="+b.word}var a='<div class="lfbox" style="width:{0};height:{1}">';a=a.replace("{0}",ibbgphoto1.width).replace("{1}",ibbgphoto1.height);a+='<small><img src="images/ic.png" alt="{1}" /></small>';a+="<h2>{0}</h2>".replace("{0}",b.title);a+='<a href="{0}" target="_blank">查看详细</a>'.replace("{0}",b.url);a+='<big><img src="{0}" alt="{1}" width="235" height="130" /></big>'.replace("{1}",b.title);a=a.replace("{0}",b.photo).replace("{1}",b.title);a+="</div>";return a}function addMapMenu(data){var opts={width:200};var menu=new BMap.ContextMenu();var txtMenuItem="[";for(var i=0;i<data.length;i++){txtMenuItem+='{"text":"'+data[i].title+'","callback":function () {markerClick('+data[i].id+",undefined);}}";if(i!=data.length-1){txtMenuItem+=","}}txtMenuItem+="]";txtMenuItem=eval("("+txtMenuItem+")");for(var i=0;i<txtMenuItem.length;i++){menu.addItem(new BMap.MenuItem(txtMenuItem[i].text,txtMenuItem[i].callback,opts));if(i!=txtMenuItem.length-1){menu.addSeparator()}}map.addContextMenu(menu)}var dats=undefined;(function(){$(function(){var h=($(window).height()-30)/2;$("#loading").css({"margin-top":h+"px"});scrollUL($(".ul0"),$(window).height()-276-25);scrollUL1($(".ul1"),$(window).height()-276-25);window.onresize=function(){scrollUL($(".ul0"),$(window).height()-276-25);scrollUL1($(".ul1"),$(window).height()-276-25)};var bmapdatsurl="_codes/bmapdats.ashx";dats=eval("("+getDats(bmapdatsurl)+")")})})();function scrollUL(b,a){if(a<=0){return}if($(".scroll_zone").size()>0){b.each(function(){if($(this).find(".scroll_zone").size()>0){$(this).html($(this).find("div:eq(0)").html());$(this).find("div:eq(0)").remove()}});$(".scroll_zone").remove()}b.each(function(){$(this).height(a);$(this).setScroll({img:"images/scrollbar_track.png",width:16},{img:"images/close.png",height:0},{img:"images/close.png",height:0},{img:"images/scrollbar_handle.png",height:18})})}function scrollUL1(b,a){if(a<=0){return}if($(".scroll_zone1").size()>0){b.each(function(){if($(this).find(".scroll_zone1").size()>0){$(this).html($(this).find("div:eq(0)").html());$(this).find("div:eq(0)").remove()}});$(".scroll_zone1").remove()}b.each(function(){$(this).height(a);$(this).setScroll1({img:"images/scrollbar_track.png",width:16},{img:"images/close.png",height:0},{img:"images/close.png",height:0},{img:"images/scrollbar_handle.png",height:18})})}function tabs(){$(".tab").each(function(a){$(this).click(function(){var b=$(this).attr("class");if(a==0&&b=="tab title01 hover"){return}if(a==1&&b=="tab title02 hover"){return}$(".tab").removeClass("hover");$(this).addClass("hover");$(".ul").hide();$(".ul"+a).show()})})}window.onload=function(){$("#loading").fadeOut(400,function(){$(this).remove()});$("#container").fadeIn(1000);tabs();if(dats&&dats.length==3){d1=dats[0];d2=dats[1];d3=dats[2];if(d1.length>=1){createMapAtPoint("mapbox",{g:d1[0].g,w:d1[0].w},parseInt(d1[0].layer));addMapMenu(d3);map.addEventListener("zoomend",function(){var b=map.getZoom();if(b<=parseInt(d1[0].layer)){map.reset()}})}if(d2){for(var a=0;a<d2.length;a++){addOverlay(d2[a])}}}};