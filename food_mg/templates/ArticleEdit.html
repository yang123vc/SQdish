<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> <?=$add_article_text?> - <?=$website_name?> <?=$admin_center?></title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <link rel="icon" type="image/png" href="templates/assets/i/favicon.png">
  <link rel="apple-touch-icon-precomposed" href="templates/assets/i/app-icon72x72@2x.png">
  <meta name="apple-mobile-web-app-title" content="Amaze UI" />
  <link rel="stylesheet" href="templates/assets/css/amazeui.min.css"/>
  <link rel="stylesheet" href="templates/assets/css/admin.css">
  <link href="/js/umeditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
</head>
<body>
<!--[if lte IE 9]>
<p class="browsehappy">你正在使用<strong>过时</strong>的浏览器，Amaze UI 暂不支持。 请 <a href="http://browsehappy.com/" target="_blank">升级浏览器</a>
  以获得更好的体验！</p>
<![endif]-->

<?php
	// header
	include 'templates/header.htm';
?>

<div class="am-cf admin-main">
  <!-- sidebar start -->
  <?php
	// 左边栏
	include 'templates/sidebar.htm';
  ?>
  <!-- sidebar end -->

  <!-- content start -->
  <div class="admin-content">
    <div class="am-cf am-padding">
      <div class="am-fl am-cf"><strong class="am-text-primary am-text-lg"> <?=$edit_article_text?></strong></div>
    </div>

    <hr/>

    <div class="am-g">

      <div class="am-u-sm-12 am-u-md-4 am-u-md-push-8">
        <div class="am-panel am-panel-default">
          <div class="am-panel-bd">
            <div class="am-g">
              <div class="am-u-md-12">
                <img id="showimg" class="am-img-circle am-img-thumbnail" src="<?php echo $r['articleThumb'];?>" alt=""/>
              </div>
              <div class="am-u-md-12">
                <p><?=$article_pic_text?></p>
                <form class="am-form">
                  <div class="am-form-group">
						<div class="btn">
							<span><?=$upload_pic_text?></span>
							<input id="fileupload" type="file" name="mypic">
						</div>
						<div class="progress">
							<span class="bar"></span><span class="percent">0%</span >
						</div>
						<div class="files"></div>
                    <p class="am-form-help"><?=$choose_file_text?>...</p>
					<p class="am-form-help"><a class="am-btn am-btn-danger" href="javascript:;" id="delPic" data-id=""> <?=$delete_text?> </a></p>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
				
<!---推荐配图上传---->
				<div class="am-panel am-panel-default">
          <div class="am-panel-bd">
            <div class="am-g">
              <div class="am-u-md-12">
                <img id="showimgs" class="am-img-circle am-img-thumbnail" src="<?php echo $r['articlePic']?>" alt=""/>
              </div>
              <div class="am-u-md-12">
                <p><?=$article_recommend_pic?></p>
                <form class="am-form">
                  <div class="am-form-group">
						<div class="btns">
							<span><?=$upload_pic_text?></span>
							<input id="fileuploads" type="file" name="mypic">
						</div>
						<div class="progresss">
							<span class="bars"></span><span class="percents">0%</span >
						</div>
						<div class="filess"></div>
                    <p class="am-form-help"><?=$choose_file_text?>...</p>
					<p class="am-form-help"><a class="am-btn am-btn-danger" href="javascript:;" id="delPics" data-id=""> <?=$delete_text?> </a></p>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
				
				
				
				
				
				

      </div>

      <div class="am-u-sm-12 am-u-md-8 am-u-md-pull-4">
		<!--防止误操作，action的文件名故意加了_1，看清楚doArticle.php做什么的再改-->
        <form action="articleEdit.php" onSubmit="return uptext();" id="form" method="post" class="am-form am-form-horizontal">
			<input type="hidden" name="action" value="edit" />
			<input type="hidden" name="id" value="<?php echo $r['id']; ?>" />
			<input type="hidden" id="_pic" name="articleThumb" value="<?php echo $r['articleThumb']; ?>" />
			<input type="hidden" id="pics" name="articlePic" value="<?php echo $r['articlePic']; ?>" />
			
			  
			
			<div class="am-form-group"><!--文章标题-->
				<label for="user-name" class="am-u-sm-3 am-form-label"><?=$article_title_text?> </label>
				<div class="am-u-sm-9">
				  <input type="text" name="articleTitle" value="<?php echo $r['articleTitle']; ?>" id="articleTitle" placeholder="<?=$article_title_text?>">
				  <small class="am-text-danger"><?=$article_title_text?><?=$doest_null?> </small>
				</div>
			</div>
			
			<div class="am-form-group"><!--所属分类-->
				<label for="user-name" class="am-u-sm-3 am-form-label"><?=$article_category_text?> </label>
				<div class="am-u-sm-9"  >
				  <select id="articleCategory" name="articleCategory">
					<?php 
						foreach($category as $k=>$v){
						$l=$_SESSION['language'];
						if($l=="cn"){$cname=$v['categoryNameZ'];}
						if($l=="thai"){$cname=$v['categoryNameT'];}
						if($l=="en"){$cname=$v['categoryNameE'];}
						if($v['id']==$r['articleCategory']){$select="selected";}else{$select='';}
						echo "<option value=\"{$v['id']}\" $select>
						{$v['id']}|$cname
						</option>";
						}
					?>		
				  </select>
				</div>
			</div>
			
			<div class="am-form-group">
				<!--作者，获取登录用户的用户名或者自己填-->
				<label for="user-name" class="am-u-sm-3 am-form-label"><?=$article_author_text?> </label>
				<div class="am-u-sm-3">
				  <input type="text" name="articleAuthor" value="<?php echo $r['articleAuthor'];?>" id="articleAuthor" placeholder="<?=$article_author_text?>">
				</div>
				<!--点击量，前台每刷新一次就增加一次点击量，不排除ip，第一次录入的时候随机产生一个100-300的随机数保存-->
				<label for="user-name" class="am-u-sm-3 am-form-label"><?=$article_click_text?> </label>
				<div class="am-u-sm-3">
				  <input type="text" name="articleClick" value="<?php echo $r['articleClick'];?>" id="articleClick" placeholder="<?=$article_click_text?>">
				</div>
			</div>
			
			
			<div class="am-form-group"><!--关键词标题-->
				<label for="user-name" class="am-u-sm-3 am-form-label"><?=$article_keywords_text?> </label>
				<div class="am-u-sm-9">
				  <input type="text" name="articleKeyword" value="<?php echo $r['articleKeyword'] ?>" id="articleKeyword" placeholder="<?=$article_keywords_text?>">
				  <small class="am-text-danger"><?=$article_keywords_tips?></small>
				</div>
			</div>
			
			<div class="am-form-group"><!--简介-->
				<label for="user-name" class="am-u-sm-3 am-form-label"><?=$article_des_text?> </label>
				<div class="am-u-sm-9">
				  <textarea class="" rows="5" name="articleDes" id="articleDes"><?=$r['articleDes']?></textarea>
					<small class="am-text-danger"><?=$article_des_trips_text?></small>
				</div>
			</div>
			
			<div class="am-form-group"><!--是否推荐-->
				<label for="user-name" class="am-u-sm-3 am-form-label"><?=$article_recommend_text?> </label>
				<div class="am-u-sm-9">
					<label class="am-radio-inline">
						<input type="radio"  value="1" name="articleIst" <?php if($r['articleIst']==1){echo 'checked'; } ?> > <?=$yes_text?>
					</label>
					<label class="am-radio-inline">
						<input type="radio" name="articleIst" value="0" <?php if($r['articleIst']==0){echo 'checked'; } ?> > <?=$no_text?>
					</label>
				</div>
			</div>
			<!--
			<div class="am-form-group">推荐配图
				<label for="user-name" class="am-u-sm-3 am-form-label"><?=$article_recommend_pic?> </label>
				<div class="am-u-sm-9">
					<input id="fileuploadsss" type="file" name="">
					<small class="am-text-danger"><?=$article_article_recommend_pic_tips?></small>
				</div>
			</div>-->
			
			<div class="am-form-group"><!--是否伪原创-->
				<label for="user-name" class="am-u-sm-3 am-form-label"><?=$article_fakeOriginal_text?> </label>
				<div class="am-u-sm-9">
					<label class="am-radio-inline">
						<input type="radio"  value="1" name="articleIsw" > <?=$yes_text?>
					</label>
					<label class="am-radio-inline">
						<input type="radio" value="0" name="articleIsw" checked > <?=$no_text?>
					</label>
				</div>
			</div>
			
			<div class="am-form-group"><!--是否自动启用锚文本-->
				<label for="user-name" class="am-u-sm-3 am-form-label"><?=$article_alink_text?> </label>
				<div class="am-u-sm-9">
					<label class="am-radio-inline">
						<input type="radio"  value="1" name="articleIsm" > <?=$yes_text?>
					</label>
					<label class="am-radio-inline">
						<input type="radio"  value="0" name="articleIsm" checked> <?=$no_text?>
					</label>
				</div>
			</div>

            <div class="am-form-group"><!--百度编辑器-->
				<label for="user-intro" class="am-u-sm-3 am-form-label"><?=$article_body?></label>
				<div class="am-u-sm-9">   
				<input type="hidden" id="_intro" name="articleBody" value="" />
					<script type="text/plain" id="myEditor"  style="width:100%;height:240px;">
						<?php echo $r['articleBody']; ?>
					</script>
				</div>
            </div>

            <div class="am-form-group">
				<div class="am-u-sm-9 am-u-sm-push-3">
				  <button type="submit" class="am-btn am-btn-primary"><?=$save_text?></button>
				</div>
            </div>
        </form>
      </div>
    </div>
  </div>
  <!-- content end -->

</div>

<a class="am-icon-btn am-icon-th-list am-show-sm-only admin-menu" data-am-offcanvas="{target: '#admin-offcanvas'}"></a>

<?php
	// footer
	include 'templates/footer.htm';
?>

<!--[if lt IE 9]>
<script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
<script src="http://cdn.staticfile.org/modernizr/2.8.3/modernizr.js"></script>
<script src="assets/js/polyfill/rem.min.js"></script>
<script src="assets/js/polyfill/respond.min.js"></script>
<script src="assets/js/amazeui.legacy.js"></script>
<![endif]-->

<!--[if (gte IE 9)|!(IE)]><!-->
<script src="templates/assets/js/jquery.min.js"></script>
<script src="templates/assets/js/jquery.form.js"></script>
<script src="templates/assets/js/jquery.Jcrop.js"></script>
<script src="templates/assets/js/amazeui.min.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/umeditor/umeditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/umeditor/umeditor.min.js"></script>
<script type="text/javascript" src="/js/umeditor/lang/zh-cn/zh-cn.js"></script>
<!--<![endif]-->
<script>
$("#delPic").click(function(){
	if(confirm("确认删除所选图片？")){
	$("#showimg").attr('src','');
	$("#_pic").val('');
	}
});
$("#delPics").click(function(){
	if(confirm("确认删除所选图片？")){
	$("#showimgs").attr('src','');
	$("#pics").val('');
	}
});

	(function($) {
	  'use strict';

	  $(function() {
		var $fullText = $('.admin-fullText');
		$('#admin-fullscreen').on('click', function() {
		  $.AMUI.fullscreen.toggle();
		});

		$(document).on($.AMUI.fullscreen.raw.fullscreenchange, function() {
		  $.AMUI.fullscreen.isFullscreen ? $fullText.text('<?=$close_full_text?>') : $fullText.text('<?=$open_full_text?>');
		});
	  });
	})(jQuery);
</script>
<script>
	(function($){
		$.fn.extend({
			GlobalGeography:function(){
				 
				/* ._GlobalGeography_ { width:282px; height:30px !important; position:relative; left:-282px; top:2px; } */
				 
				var relatedObj = ['div[id="country"]','div[id="state"]','div[id="city"]','div[id="region"]'];
				var excludeObj = ['div[id="region"]'];   
				var selectmenu = ['country','state','city','region'];
				var selector   = this.selector;
				 
				/*输出下拉列表*/
				function _traversal(source,type,text){
					//console.log(source);
				
					if(typeof(source)!='undefined'){
						var _select_  = '<select class="_GlobalGeography_">';
							_select_ += '<option value=""></option>';
						$.each(source,function(i,v){
							//console.log(v.Name+":"+v.Code);
							if(typeof(text)!='undefined' && text == v.Name)
								_select_ += '<option selected value="'+v.Code+'">'+v.Name+'</option>';
							else 
								_select_ += '<option value="'+v.Code+'">'+v.Name+'</option>';
						});
						_select_ += '</select>';
						return _select_;
					}
					return false;
				};
				 
				/*清除/还原下级关联下拉菜单*/
				function cleanNextMenu(index){
					for(var i=index;i<relatedObj.length;i++){
						if(typeof(relatedObj[(i+1)])!='undefined'){
							$(relatedObj[(i+1)]).find('._GlobalGeography_').remove();
							$(relatedObj[(i+1)]).find('input').val('');
						}
					}
				}
				
				/* 初始化 */
				function initValue(i){
					i++;
				
					for(i;i<selectmenu.length;i++){
						//console.log("index:"+i);
						$("#"+selectmenu[i]+"Value").val("");
					}
				}
				 
				/*遍历获取下拉菜单内容*/
				function checkMenu(json){				
					/*遍历赋值所有类型*/
					$.each(relatedObj,function(i,v){
						if($.inArray(v,excludeObj)==-1){
							$(v).find('select').bind('change',function(){
								var _code_ = $(this).val(); cleanNextMenu(i);
								if(typeof(json[selectmenu[(i+1)]][_code_])!='undefined'){
									//console.log("i+1:"+selectmenu[(i+1)]+":"+_code_);
								
									$(relatedObj[(i+1)]).append(_traversal(json[selectmenu[(i+1)]][_code_],selectmenu[(i+1)]));
									/*绑定方法*/
									$(relatedObj[(i+1)]).find('._GlobalGeography_').bind('change',function(){
										$(relatedObj[(i+1)]).find('input').val($(this).find('option:selected').text());
									});
									checkMenu(json);
								} else {
									if(typeof(selectmenu[(i+2)]) != 'undefined' && typeof(json[selectmenu[(i+2)]][_code_]) != 'undefined'){										
										$(relatedObj[(i+2)]).append(_traversal(json[selectmenu[(i+2)]][_code_]));
										/*绑定方法*/
										$(relatedObj[(i+2)]).find('._GlobalGeography_').bind('change',function(){
											$(relatedObj[(i+2)]).find('input').val($(this).find('option:selected').text());
										});
										checkMenu(json);
									}
								}
							});
						}
					});
					
					/* 为生成的新元素添加事件 */
					$(".selectCountry select").on('change',function(){
						var text = $(this).find("option:selected").text();
						var id = $(this).parent(".selectCountry").attr("id");
						var i = $(this).parent(".selectCountry").data("index");
						
						initValue(i);
						$("#"+id+"Value").val(text);
					});
				}
				 
				/*加载世界国家城市数据*/
				$.getJSON("getCountry.php",function(json){
					/*输出国家列表*/
					$(selector).append(_traversal(json.country,'country'));
					$(selector).find('._GlobalGeography_').bind('change',function(){
						$(selector).find('input').val($(this).find('option:selected').text());
					});
					checkMenu(json);
				});
			}
		})
	})(jQuery);
	
	$(document).ready(function(){
		$('#country').GlobalGeography();
	});

	var um = UM.getEditor('myEditor');
	var flag = 1;


	
	$(function(){
		var bar = $('.bar');
		var percent = $('.percent');
		var showimg = $('#showimg');
		var progress = $(".progress");
		var files = $(".files");
		var btn = $(".btn span");
		var pic = $("#_pic");
		
		$("#fileupload").wrap("<form id='myupload' action='uploadAction.php' method='post' enctype='multipart/form-data'></form>");
		$("#fileupload").change(function(){
				$("#myupload").ajaxSubmit({
					dataType:  'json',
					beforeSend: function() {
						showimg.attr('src','');
						progress.show();
						var percentVal = '0%';
						bar.width(percentVal);
						percent.html(percentVal);
						btn.html("上传中...");
						flag = -1;
					},
					uploadProgress: function(event, position, total, percentComplete) {
						var percentVal = percentComplete + '%';
						bar.width(percentVal);
						percent.html(percentVal);
					},
					success: function(data) {
						//files.html("<b>"+data.name+"("+data.size+"k)</b> <span class='delimg' rel='"+data.pic+"'><?=$delete_text?></span>");
						files.hide();
						var img = data.pic;
						showimg.attr('src', img);
						pic.val(img);
						btn.html("<?=$upload_success_text?>！");
						flag = 1;
						//btn.html("<a rel='"+data.pic+"' href='javascript:;' class='c_button'><img src='/member/resources/img/crop_button.png'></a>");
						//btn.show();
					},
					error:function(xhr){
						files.show();
						alert("<?=$upload_pic_error?>");
						btn.html("<?=$upload_pic_error?>");
						bar.width('0')
						files.html(xhr.responseText);
						flag = 1;
					}
				});
			});
	});
	
	function uptext(){
		$("#_intro").val(UM.getEditor('myEditor').getContent());
		
		if(!$("#articleTitle").val()){
			$("#articleTitle").focus();
			return false;
		}
		if(flag == 1){
			return true;
		}else if(flag == -1){
			alert("is verifying the picture, please wait a moment!");
			return false;
		}
	}
</script>




				
				<script>
					$(function(){
		var bars = $('.bars');
		var percents = $('.percents');
		var showimgs = $('#showimgs');
		var progresss = $(".progresss");
		var filess = $(".filess");
		var btns = $(".btns span");
		
		
		$("#fileuploads").wrap("<form id='myuploads' action='uploadAction.php' method='post' enctype='multipart/form-data'></form>");
		$("#fileuploads").change(function(){
				$("#myuploads").ajaxSubmit({
					dataType:  'json',
					beforeSend: function() {
						showimgs.attr('src','');
						progresss.show();
						var percentVal = '0%';
						bars.width(percentVal);
						percents.html(percentVal);
						btns.html("上传中...");
						flag = -1;
					},
					uploadProgress: function(event, position, total, percentComplete) {
						var percentVal = percentComplete + '%';
						bars.width(percentVal);
						percents.html(percentVal);
					},
					success: function(data) {
						//filess.html("<b>"+data.name+"("+data.size+"k)</b> <span class='delimg' rel='"+data.pic+"'><?=$delete_text?></span>");
						filess.hide();
						var img = data.pic;
						showimgs.attr('src', img);
					//	alert(img);
						//pics.val(img);
						$("#pics").val(img);
						//alert($("#pics").val());
						btns.html("<?=$upload_success_text?>！");
						flag = 1;
						//btns.html("<a rel='"+data.pic+"' href='javascript:;' class='c_button'><img src='/member/resources/img/crop_button.png'></a>");
						//btns.show();
					},
					error:function(xhr){
						filess.show();
						alert("<?=$upload_pic_error?>");
						btns.html("<?=$upload_pic_error?>");
						bars.width('0')
						filess.html(xhr.responseText);
						flag = 1;
					}
				});
			});
	});	
	</script>
				
				
</body>
</html>
